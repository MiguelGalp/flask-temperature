{% extends "bootstrap/base.html" %}

{% block title %}Discursos del odio en X{% endblock %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/customCSS.css') }}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container">
    <div class="col-12 col-md-5 offset-md-4">
        
            <div class="row">
                <!-- Time difference calculation -->
                {% if last_total_increase %}
                {% set now = datetime.now(pytz.timezone('America/Montevideo')) - timedelta(minutes=180) %}
                {% set time_diff = now - last_total_increase.timestamp %}
                {% set minutes_diff = time_diff.total_seconds() // 60 %}
                <div class="offset-0 offset-md-0 rounded-3 w-50"><mark class="ms-3 rounded-2">{{ minutes_diff }} minutos
                        atrás</mark>
                </div>
                {% else %}
                <h5>Compuestos del odio hace ... minutos</h5>
                {% endif %}
            </div>
            <div class="card position-background">
                <div class="card-body rounded" style="background-color: #fffcf0;">
                    {% for user, engagement in user_engagements %}
                    {% if user == 'yanilatorre' %}
                    {% set user = 'La violencia en acto (Verdaderas apologías del odio)' %}
                    {% elif user == 'SergioChouza' %}
                    {% set user = 'Auto-percibidos influencers (La prepotencia)' %}
                    {% elif user == 'atilioboron' %}
                    {% set user = 'Dicen mentira por verdad (¿Auto-engaño? ¿Lo sabrán?)' %}
                    {% elif user == 'CarlosMaslaton' %}
                    {% set user = 'Lograron la anomía, el vacío (El mérito de la parca)' %}
                    {% elif user == 'rialjorge' %}
                    {% set user = 'Maestros de la manipulación (Al servicio de la $$$)' %}
                    {% elif user == 'alexcaniggia' %}
                    {% set user = 'Imágenes que me (sobre) excitan -- Todo es demasiado' %}
                    {% endif %}
                    {% if engagement > 1 %}
                    {% set engagement = 1 %}
                    {% endif %}
                    <div class="p-1" style="background-color: #fffcf0; border: 1px solid #000;">
                        <div
                            style="height: 22px; width: {{ '%.2f'|format(min(engagement * 1000, 100)) }}%; background-color: #000; ">
                        </div>
                    </div>
                    <p class="text-uppercase text-custom fw-bold">{{ user }}</p>
                    {% endfor %}
                </div>
            </div>
            <div class="row w-75 ms-3">
                <mark class="rounded-3 custom-width py-0 mt-1">
                    {% if peak_occurrences %}
                    <i class="bi bi-graph-up d-inline"></i>
                    {% for timestamp, engagement in peak_occurrences %}
                    <p class="d-inline">{{ timestamp.strftime('%Y-%m-%d %H:%M:%S') }}: {{
                        engagement }}</p>
                    {% endfor %}
                    {% else %}
                    <i class="bi bi-graph-up d-inline"></i>
                    <p class="d-inline">sin picos</p>
                    {% endif %}
                </mark>
            
        </div>
        <div class="row mt-4">
            <div class="col-12 col-md-6">
                <!-- Hero text "ODIO ODIO" with the second "ODIO" flipped -->
                <div class="hero-text hate-text ">
                    ODIO <span class="flipped-text">ODIO</span>
                </div>
                <!-- Subtext below hero text -->
                <div class="subtext ms-4 mt-3 negative-letter-spacing fw-bold"
                    style="font-size: 18px; line-height:97%; color: #0f0f0f;">
                    UN MAPA EMOCIONAL Y PERSONAL DE LA INFLUENCIA DE X. ES EN TIEMPO REAL: UN RANKING CRÍTICO DE MI TL.
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}