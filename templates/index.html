{% extends "bootstrap/base.html" %}

{% block title %}Opio de los pueblos: Twitter trackeado{% endblock %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/customCSS.css') }}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
{% endblock %}


{% block content %}

<div class="container">
    <div class="row custom-position-content">
        <div class="col-12 col-md-1 offset-md-2 text-center avatars-positions">
            <img id="avatar_1" src="./static/public/Argentina.png" alt="MG" width="28" height="28" />
            <br>
            <br>
            <img id="avatar_2" src="./static/public/Chile.png" alt="LA" width="28" height="28" />
        </div>

        <div class="col-12 col-md-4 col-lg-4 col-xl-4 custom-margin-top" style="max-width: 250px;">
            <div class="row">
                <!-- Time difference calculation -->
                {% if last_total_increase %}
                {% set now = datetime.now(pytz.timezone('America/Montevideo')) - timedelta(minutes=180) %}
                {% set time_diff = now - last_total_increase.timestamp %}
                {% set minutes_diff = time_diff.total_seconds() // 60 %}
                <div class="offset-0 offset-md-0 rounded-3" style="width: 75%"><mark class="ms-3 rounded-2">{{
                        minutes_diff }} minutos
                        atr√°s</mark>
                </div>
                {% else %}
                <h6>Compuestos del odio hace ... minutos</h6>
                {% endif %}
            </div>
            <div class="card position-background" style="width:95%">
                <div class="card-body rounded" style="background-color: #fffcf0;">
                    <div class="p-2" style="background-color: #fffcf0; border: 1px solid #000;">
                        <div
                            style="height: 17px; width: {{ '%.2f'|format(min(total_engagement * 1000, 100)) }}%; background-color: #84c6c6; opacity: 30%;">
                        </div>
                    </div>
                    <p class="py-2 px-3 mt-2 rounded-2"
                        style="font-weight: 600; background-color: #fac46f; color: #000;">{{ max_engagement_group }}</p>
                </div>
            </div>
            <div class="card position-background" style="width:95%; margin-top: 5px;">
                <div class="card-body rounded custom-padding" style="background-color: #fffcf0;">
                    <div class="toxicity-meter custom-layout">
                        <span class="text-bajada fs-5"
                            style="margin-top: 0px !important; margin-left: 6px !important">TOXICIDAD {{
                            engagement_level }}</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-2 mx-4">

            <div class="row text-uppercase">
                <p class="text-bajada fs-5">
                    Toxicidad en Twitter. 24/7. <u>Ayudanos a mejorar.</u>
                </p>
            </div>

        </div>
        <div class="col-12 col-md-2 text-center">
            <img id="hero" src="./static/public/Argentina.png" alt="MG" class="pic-size negative-margin" />
        </div>
        <div class="col-1 col-md-1 github-positioning">
            <div class="text-start negative-margin" style="position: relative; left: 20px;">
                <a href="https://github.com/MiguelGalp/opiodelospueblos"><img id="github_icon"
                        src="./static/public/github-logo.png" alt="GitHub" width="20" height="20" /></a>
            </div>
        </div>


    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.getElementById('avatar_2').addEventListener('click', function () {
        console.log('Avatar 2 clicked'); 
        // Change the hero image source
        document.getElementById('hero').src = "./static/public/Chile.png";

        // Change the color of the hero text
        

        // Make an AJAX request to the new route
        fetch('/api/total_engagement_chile')
            .then(response => response.json())
            .then(data => {
                
                console.log(data);  // Add this line
                console.log(data.total_engagement); 
                // Update the card component with the new data
                var card = document.querySelector('.card-body');
                card.innerHTML = '';

                // Create new elements for the total engagement
                var engagementDiv = document.createElement('div');
                engagementDiv.className = 'p-2';
                engagementDiv.style.backgroundColor = '#fffcf0';
                engagementDiv.style.border = '1px solid #000';

                var engagementBar = document.createElement('div');
                engagementBar.style.height = '17px';
                engagementBar.style.width = (Math.min(data.total_engagement * 1000, 100)).toFixed(2) + '%';
                engagementBar.style.backgroundColor = '#84c6c6';
                engagementBar.style.opacity = '30%';
                engagementDiv.appendChild(engagementBar);

                // Create new elements for the max engagement group
                var groupP = document.createElement('p');
                groupP.className = 'py-2 px-3 mt-1 mb-1 rounded-2';
                groupP.style.fontWeight = '600';
                groupP.style.backgroundColor = '#fac46f';
                groupP.style.color = '#000';
                groupP.textContent = data.max_engagement_group;

                // Append new elements to the card
                card.appendChild(engagementDiv);
                card.appendChild(groupP);
            });
    });

    document.getElementById('avatar_1').addEventListener('click', function () {
        // Change the hero image source
        document.getElementById('hero').src = "./static/public/Argentina.png";

        // Change the color of the hero text
        

        // Make an AJAX request to the new route
        fetch('/api/total_engagement_argentina')
            .then(response => response.json())
            .then(data => {

                console.log(data);  // Add this line
                // Update the card component with the new data
                var card = document.querySelector('.card-body');
                card.innerHTML = '';

                // Create new elements for the total engagement
                var engagementDiv = document.createElement('div');
                engagementDiv.className = 'p-2';
                engagementDiv.style.backgroundColor = '#fffcf0';
                engagementDiv.style.border = '1px solid #000';

                var engagementBar = document.createElement('div');
                engagementBar.style.height = '17px';
                engagementBar.style.width = (Math.min(data.total_engagement * 1000, 100)).toFixed(2) + '%';
                engagementBar.style.backgroundColor = '#84c6c6';
                engagementBar.style.opacity = '30%';
                engagementDiv.appendChild(engagementBar);

                // Create new elements for the max engagement group
                var groupP = document.createElement('p');
                groupP.className = 'py-2 px-3 mt-1 mb-1 rounded-2';
                groupP.style.fontWeight = '600';
                groupP.style.backgroundColor = '#fac46f';
                groupP.style.color = '#000';
                groupP.textContent = data.max_engagement_group;

                // Append new elements to the card
                card.appendChild(engagementDiv);
                card.appendChild(groupP);
            });
    });
</script>
{% endblock %}