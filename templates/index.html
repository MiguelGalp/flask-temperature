{% extends "bootstrap/base.html" %}

{% block title %}Discursos del odio en X{% endblock %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/customCSS.css') }}">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    document.getElementById('avatar_2').addEventListener('click', function () {
        // Get the list of chosen users
        var users = ['MabelPajarita', 'lilialemoine', 'CarlosMaslaton', 'alexcaniggia'];

        // Function to change usernames
        function changeUsername(username) {
            switch (username) {
                case 'yanilatorre':
                    return 'Ms. Odio';
                case 'SergioChouza':
                    return 'El Capanga';
                case 'atilioboron':
                    return 'Profesor Nada';
                case 'CarlosMaslaton':
                    return 'Un Payaso';
                case 'rialjorge':
                    return 'Pastor del mal';
                case 'alexcaniggia':
                    return 'Rey de copas';
                case 'lilialemoine':
                    return 'Pitonisa del Caos';
                case 'MabelPajarita':
                    return 'Pepita la Pistolera';
                default:
                    return username;
            }
        }

        // Make an AJAX request to the new route
        fetch('/engagement_by_users', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ users: users })
        })
            .then(response => response.json())
            .then(data => {
                // Update the card component with the new data
                var card = document.querySelector('.card-body');
                card.innerHTML = '';
                data.forEach(function (user) {
                    if (user[1] > 0) {
                        // Create new elements for the user
                        var engagementDiv = document.createElement('div');
                        engagementDiv.className = 'p-1';
                        engagementDiv.style.backgroundColor = '#fffcf0';
                        engagementDiv.style.border = '1px solid #000';

                        var engagementBar = document.createElement('div');
                        engagementBar.style.height = '15px';
                        engagementBar.style.width = Math.min(user[1] * 10000, 100) + '%';
                        engagementBar.style.backgroundColor = '#000';
                        engagementDiv.appendChild(engagementBar);

                        var userP = document.createElement('p');
                        userP.className = 'text-uppercase';
                        userP.style.fontWeight = '900';
                        userP.style.letterSpacing = '-.5px';
                        userP.textContent = changeUsername(user[0]);

                        // Append new elements to the card
                        card.appendChild(engagementDiv);
                        card.appendChild(userP);
                    }
                });
            });
    });


    document.getElementById('avatar_1').addEventListener('click', function () {
        // Function to change usernames
        function changeUsername(username) {
            switch (username) {
                case 'yanilatorre':
                    return 'Ms. Odio';
                case 'SergioChouza':
                    return 'El Capanga';
                case 'atilioboron':
                    return 'Profesor Nada';
                case 'CarlosMaslaton':
                    return 'Un Payaso';
                case 'rialjorge':
                    return 'Pastor del mal';
                case 'alexcaniggia':
                    return 'Rey de copas';
                case 'lilialemoine':
                    return 'Pitonisa del Caos';
                case 'MabelPajarita':
                    return 'Pepita la Pistolera';
                default:
                    return username;
            }
        }

        // Make an AJAX request to the original route
        fetch('/engagement')
            .then(response => response.json())
            .then(data => {
                // Update the card component with the new data
                var card = document.querySelector('.card-body');
                card.innerHTML = '';
                data.forEach(function (user) {
                    // Only add users with non-zero engagement
                    if (user[1] > 0) {

                        // Create new elements for the user
                        var engagementDiv = document.createElement('div');
                        engagementDiv.className = 'p-1';
                        engagementDiv.style.backgroundColor = '#fffcf0';
                        engagementDiv.style.border = '1px solid #000';

                        var engagementBar = document.createElement('div');
                        engagementBar.style.height = '15px';
                        engagementBar.style.width = Math.min(user[1] * 10000, 100) + '%';
                        engagementBar.style.backgroundColor = '#000';
                        engagementDiv.appendChild(engagementBar);

                        var userP = document.createElement('p');
                        userP.className = 'text-uppercase';
                        userP.style.fontWeight = '900';
                        userP.style.letterSpacing = '-.5px';
                        userP.textContent = changeUsername(user[0]);

                        // Append new elements to the card
                        card.appendChild(engagementDiv);
                        card.appendChild(userP);
                    }
                });
            });
    });

</script>
{% endblock %}

{% block content %}

<div class="container">
    <div class="row custom-position-content">
        <div class="col-12 col-md-1 offset-md-3 avatar-margin ">
            <div class="text-center" style="margin-top: 20px;">
                <img id="avatar_1" src="./static/public/avatar.png" alt="MG" width="28" height="28" />
                <br>
                <br>
                <img id="avatar_2" src="./static/public/avatar.png" alt="MG" width="28" height="28" />
            </div>
        </div>

        <div class="col-12 col-md-3 col-lg-3 col-xl-2" style="margin-left: -40px;">
            <div class="row">
                <!-- Time difference calculation -->
                {% if last_total_increase %}
                {% set now = datetime.now(pytz.timezone('America/Montevideo')) - timedelta(minutes=180) %}
                {% set time_diff = now - last_total_increase.timestamp %}
                {% set minutes_diff = time_diff.total_seconds() // 60 %}
                <div class="offset-0 offset-md-0 rounded-3" style="width: 75%"><mark class="ms-3 rounded-2">{{
                        minutes_diff }} minutos
                        atrás</mark>
                </div>
                {% else %}
                <h6>Compuestos del odio hace ... minutos</h6>
                {% endif %}
            </div>
            <div class="card position-background" style="width:95%">
                <div class="card-body rounded" style="background-color: #fffcf0;">
                    {% for user, engagement in user_engagements %}
                    {% if engagement > 0 %}
                    {% if user == 'yanilatorre' %}
                    {% set user = 'Ms. Odio' %}
                    {% elif user == 'SergioChouza' %}
                    {% set user = 'El Capanga' %}
                    {% elif user == 'atilioboron' %}
                    {% set user = 'Profesor Nada' %}
                    {% elif user == 'CarlosMaslaton' %}
                    {% set user = 'Un Payaso' %}
                    {% elif user == 'rialjorge' %}
                    {% set user = 'Pastor del mal' %}
                    {% elif user == 'alexcaniggia' %}
                    {% set user = 'Rey de copas' %}
                    {% elif user == 'lilialemoine' %}
                    {% set user = 'Pitonisa del Caos' %}
                    {% elif user == 'MabelPajarita' %}
                    {% set user = 'Pepita la Pistolera' %}
                    {% endif %}
                    {% if engagement > 1 %}
                    {% set engagement = 1 %}
                    {% endif %}
                    <div class="p-1" style="background-color: #fffcf0; border: 1px solid #000;">
                        <div
                            style="height: 15px; width: {{ '%.2f'|format(min(engagement * 10000, 100)) }}%; background-color: #000; ">
                        </div>
                    </div>
                    <p class="text-uppercase" style="font-weight: 900; letter-spacing: -.5px;">{{ user }}</h6>
                        {% endif %}
                        {% endfor %}
                </div>
            </div>
        </div>
        <div class="col-12 col-md-3" style="margin-left: 3px">
            <div class="hero-text hate-text-color" style="margin-top: 13px; scale: 103%;">
                ODIO<span class="flipped-text">ODIO </span>
            </div>
            <div class="row text-uppercase custom-width"
                style="font-weight: 900; letter-spacing: -0.5px; margin-top: 8px; margin-left: -3px; line-height: 9px;">
                <p>
                    <span style="display: inline-block; margin-right: -10px;">Interacciones según seguidores</span><br>
                    <span style="display: inline-block; margin-right: 10px;">y tweets (en un ciclo de vida de 24hs).
                        Engagements y</span><br>
                    <span style="display: inline-block; margin-right: 20px;"> una suerte de espejo-venganza --o una
                    </span><br>
                    <span style="display: inline-block; margin-right: 30px;">advertencia:</span>
                    <span style="display: inline-block; margin-right: 30px;">es gente</span><br>
                    <span style="display: inline-block; margin-right: 40px;">tóxica.</span>
                </p>
            </div>
        </div>
        <div class="col-12 col-md-2">
            <img src="./static/public/avatar.png" alt="MG" class="pic-margin pic-size" />
        </div>
    </div>
</div>
{% endblock %}